<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#3a6ea5" />
  <meta name="description"
    content="Curso completo para fortalecer laços familiares e melhorar a comunicação entre pais e filhos" />
  <meta name="application-name" content="Universidade de Pais" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Universidade de Pais">

  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">

  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" href="https://via.placeholder.com/180/3a6ea5/FFFFFF?text=UP" />
  <link rel="apple-touch-icon" sizes="152x152" href="https://via.placeholder.com/152/3a6ea5/FFFFFF?text=UP" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://via.placeholder.com/180/3a6ea5/FFFFFF?text=UP" />
  <link rel="apple-touch-icon" sizes="167x167" href="https://via.placeholder.com/167/3a6ea5/FFFFFF?text=UP" />

  <title>Universidade de Pais — Curso Demo</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* ===== STYLES COMPLETOS ===== */
    :root {
      --bg: #f5f7fa;
      --card: #ffffff;
      --primary: #3a6ea5;
      --secondary: #e67e22;
      --success: #16a085;
      --accent: #8e44ad;
      --muted: #7f8c8d;
      --text: #2c3e50;
      --danger: #c0392b;
      --warning: #f1c40f;
      --dark-bg: #1e272e;
      --dark-card: #2f3640;
      --dark-text: #dcdde1;
      --dark-muted: #718093;
      --radius: 12px;
      --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
      transition: background-color 0.3s, color 0.3s;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior: none;
      -webkit-overflow-scrolling: touch;
    }

    /* PWA Banner */
    .pwa-install-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 15px 20px;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.5s ease-out;
      max-width: 420px;
      margin: 0 auto;
      border-top-left-radius: var(--radius);
      border-top-right-radius: var(--radius);
    }

    .pwa-install-banner.hidden {
      display: none;
    }

    @keyframes slideUp {
      from {
        transform: translateY(100%);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .pwa-banner-content {
      display: flex;
      align-items: center;
      gap: 15px;
      flex: 1;
    }

    .pwa-banner-actions {
      display: flex;
      gap: 10px;
    }

    .pwa-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9em;
      white-space: nowrap;
    }

    .pwa-btn.install {
      background: white;
      color: var(--primary);
    }

    .pwa-btn:hover {
      transform: translateY(-1px);
    }

    /* App Container */
    .app {
      width: 100vw;
      min-height: 100vh;
      overflow-x: hidden;
      background: var(--card);
      position: relative;
      display: grid;
      grid-template-rows: auto 1fr auto;
      max-width: 420px;
      margin: 0 auto;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      transition: background 0.3s, color 0.3s;
    }

    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: var(--card);
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 8px 16px;
      width: 100%;
      color: var(--text);
      max-width: 420px;
      margin: 0 auto;
    }

    /* Localize ou adicione estes estilos específicos para o header */
    header h1 {
      font-size: 1.1rem;
      /* Tamanho original costuma ser 2rem; 1.1rem é bem menor */
      line-height: 1.2;
      margin: 0;
    }

    header .muted {
      font-size: 0.75rem;
      /* Diminui a legenda "Conexão Pais e Filhos" */
      margin-top: -2px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    .brand .logo {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }

    .nav-actions {
      position: relative;
    }

    .icon {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--text);
      padding: 8px;
      border-radius: 50%;
      transition: all 0.2s;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .menu-dropdown {
      display: none;
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
      min-width: 280px;
      z-index: 1001;
      padding: 8px 0;
      animation: slideIn 0.3s ease-out;
      border: 1px solid var(--bg);
    }

    .menu-dropdown.active {
      display: block;
    }

    .menu-dropdown .tab {
      padding: 12px 16px;
      cursor: pointer;
      color: var(--text);
      font-weight: 500;
      transition: background-color 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-size: 0.95em;
    }

    .menu-dropdown .tab:hover {
      background-color: var(--bg);
    }

    /* Main Content */
    .main-content {
      padding-top: 70px;
      padding-bottom: 70px;
      overflow-y: auto;
      min-height: calc(100vh - 140px);
      -webkit-overflow-scrolling: touch;
    }

    .screen {
      padding: 20px;
      width: 100%;
      box-sizing: border-box;
      display: none;
      animation: fadeInUp 0.4s ease-out;
    }

    .screen.active {
      display: block;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      margin-bottom: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }

    /* Buttons */
    .btn {
      background-color: var(--primary);
      color: #ffffff;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-family: inherit;
      font-size: 0.95em;
    }

    .btn:hover:not(:disabled) {
      background-color: #3a7bd5;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
    }

    .btn.ghost {
      background-color: transparent;
      color: var(--text);
      border: 1px solid var(--muted);
    }

    .btn.ghost:hover:not(:disabled) {
      background-color: var(--bg);
      border-color: var(--primary);
      color: var(--primary);
    }

    /* Forms */
    input,
    textarea,
    select {
      width: 100%;
      padding: 12px;
      box-sizing: border-box;
      margin: 8px 0;
      border: 1px solid var(--bg);
      border-radius: 6px;
      background-color: var(--bg);
      color: var(--text);
      transition: all 0.2s;
      font-family: inherit;
      font-size: 0.95em;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
    }

    .form-group {
      display: flex;
      flex-direction: column;
      text-align: left;
      margin-bottom: 15px;
    }

    .form-group label {
      font-weight: 600;
      color: var(--text);
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Modules */
    .module {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
      cursor: pointer;
      padding: 15px;
      border-radius: var(--radius);
      background: var(--card);
      box-shadow: var(--shadow);
      transition: all 0.3s;
    }

    .module:hover:not(.locked) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
    }

    .module-img {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      flex-shrink: 0;
      object-fit: cover;
    }

    /* Profile */
    .profile-photo-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
    }

    #profile-photo {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 10px;
      border: 3px solid var(--primary);
    }

    /* Toggles */
    .toggle-group {
      margin: 0;
      padding: 12px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--bg);
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--muted);
      transition: .4s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked+.toggle-slider {
      background-color: var(--primary);
    }

    input:checked+.toggle-slider:before {
      transform: translateX(26px);
    }

    /* Benefits */
    .benefits-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
    }

    @media (min-width: 500px) {
      .benefits-grid {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
    }

    .benefit-card {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      padding: 20px;
      border-radius: var(--radius);
      border-left: 5px solid var(--primary);
      background-color: var(--bg);
      transition: all 0.3s;
      height: 100%;
    }

    .benefit-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }

    .benefit-icon {
      font-size: 28px;
      margin-bottom: 8px;
      color: var(--primary);
    }

    .benefit-content h3 {
      margin: 0 0 8px 0;
      font-size: 1.2em;
    }

    .benefit-content p {
      margin: 0 0 12px 0;
      color: var(--muted);
      font-size: 0.9em;
    }

    .benefit-features {
      margin: 0 0 12px 0;
      padding: 0;
      list-style: none;
    }

    .benefit-features li {
      padding: 4px 0;
      font-size: 0.85em;
      position: relative;
      padding-left: 16px;
    }

    .benefit-features li::before {
      content: "✓";
      position: absolute;
      left: 0;
      color: var(--success);
      font-weight: bold;
    }

    .benefit-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      margin-top: auto;
      font-size: 0.8em;
      color: var(--muted);
    }

    /* Filters */
    .filter-tabs {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 25px;
    }

    .filter-tab {
      padding: 8px 16px;
      border: 2px solid var(--muted);
      background: var(--bg);
      color: var(--text);
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 500;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .filter-tab.active,
    .filter-tab:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Sentiments */
    .sentiments-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 15px;
    }

    .sentiment-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 15px;
      border-radius: var(--radius);
      background: var(--bg);
      cursor: pointer;
      transition: all 0.3s;
      border-left: 4px solid var(--success);
      min-height: 70px;
    }

    .sentiment-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .emotion-icon {
      font-size: 1.8em;
      flex-shrink: 0;
    }

    .emotion-text {
      flex-grow: 1;
    }

    .emotion-text strong {
      display: block;
      font-size: 0.95em;
      margin-bottom: 4px;
    }

    .emotion-desc {
      font-size: 0.75em;
      color: var(--muted);
      display: block;
    }

    /* Filters Container */
    .filters-container {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 20px;
    }

    .filter-btn {
      padding: 8px 16px;
      border: 2px solid var(--muted);
      background: var(--bg);
      color: var(--text);
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 500;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .filter-btn.active,
    .filter-btn:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Stats */
    .stat-item {
      padding: 0 15px;
      text-align: center;
      flex: 1;
      min-width: 80px;
    }

    /* Testimonials */
    .testimonials-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-top: 15px;
    }

    @media (min-width: 500px) {
      .testimonials-grid {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
    }

    .testimonial-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--primary);
    }

    .testimonial-text {
      font-style: italic;
      margin-bottom: 15px;
      line-height: 1.5;
    }

    .testimonial-author {
      font-weight: bold;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* FAQ Styles */
    .faq-section {
      margin-top: 20px;
    }

    .faq-item {
      margin-bottom: 15px;
      border: 1px solid var(--bg);
      border-radius: var(--radius);
      overflow: hidden;
      transition: all 0.3s;
    }

    .faq-question {
      padding: 16px;
      background: var(--card);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.2s;
    }

    .faq-question:hover {
      background-color: var(--bg);
    }

    .faq-answer {
      padding: 0 16px;
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease;
      background: var(--bg);
      border-top: 1px solid transparent;
    }

    .faq-answer.active {
      padding: 16px;
      max-height: 500px;
      border-top-color: var(--bg);
    }

    /* Notes Styles */
    .notes-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .note-editor {
      margin-bottom: 20px;
    }

    .note-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .note-card {
      padding: 16px;
      background: var(--bg);
      border-radius: var(--radius);
      border-left: 4px solid var(--accent);
      transition: all 0.2s;
    }

    .note-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .note-title {
      font-weight: 600;
      color: var(--text);
      font-size: 1.1em;
    }

    .note-date {
      font-size: 0.8em;
      color: var(--muted);
      white-space: nowrap;
    }

    .note-content {
      color: var(--text);
      line-height: 1.5;
      font-size: 0.95em;
      margin-bottom: 10px;
    }

    .note-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
    }

    .note-tag {
      background: rgba(58, 110, 165, 0.1);
      color: var(--primary);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: 500;
    }

    /* Favorites Styles */
    .favorites-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
    }

    .favorite-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: all 0.2s;
      border-left: 4px solid var(--warning);
    }

    .favorite-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
    }

    .favorite-icon {
      font-size: 24px;
      color: var(--warning);
      flex-shrink: 0;
    }

    .favorite-info {
      flex-grow: 1;
    }

    .favorite-meta {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 0.85em;
      color: var(--muted);
    }

    /* Share Styles */
    .share-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .share-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 20px 10px;
      background: var(--bg);
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .share-option:hover {
      background: var(--card);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .share-icon {
      font-size: 32px;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      color: white;
    }

    .share-icon.whatsapp {
      background: #25D366;
    }

    .share-icon.facebook {
      background: #3b5998;
    }

    .share-icon.instagram {
      background: #E4405F;
    }

    .share-icon.email {
      background: var(--primary);
    }

    .share-icon.copy {
      background: var(--muted);
    }

    .share-text {
      font-weight: 600;
      font-size: 0.95em;
      color: var(--text);
    }

    /* About Styles */
    .about-content {
      margin-top: 20px;
    }

    .about-section {
      margin-bottom: 25px;
    }

    .about-section h3 {
      color: var(--primary);
      margin-bottom: 10px;
      font-size: 1.2em;
    }

    .mission-stats {
      display: flex;
      justify-content: space-around;
      text-align: center;
      margin: 25px 0;
      flex-wrap: wrap;
      gap: 20px;
    }

    .mission-stat {
      flex: 1;
      min-width: 120px;
    }

    .mission-stat-number {
      font-size: 2em;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 5px;
    }

    .mission-stat-label {
      font-size: 0.9em;
      color: var(--muted);
    }

    /* Contact Form */
    .contact-form {
      margin-top: 20px;
    }

    /* Footer */
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card);
      padding: 10px 0;
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
      display: flex;
      justify-content: space-around;
      z-index: 1000;
      border-top: 1px solid var(--bg);
      max-width: 420px;
      margin: 0 auto;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      color: var(--muted);
      transition: all 0.2s;
      padding: 5px 10px;
      border-radius: 8px;
      flex: 1;
      min-width: 60px;
    }

    .nav-item:hover {
      color: var(--primary);
      background: var(--bg);
    }

    .nav-item.active {
      color: var(--primary);
      font-weight: 700;
      background: rgba(74, 144, 226, 0.1);
    }

    .nav-item .nav-icon {
      font-size: 18px;
      margin-bottom: 4px;
    }

    /* Toast */
    #toast-container {
      position: fixed;
      bottom: 80px;
      left: 0;
      right: 0;
      z-index: 2000;
      padding: 0 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .toast {
      min-width: 250px;
      max-width: 350px;
      background-color: var(--text);
      color: #fff;
      text-align: center;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 14px;
      box-shadow: var(--shadow);
      opacity: 0;
      transition: all 0.5s;
      transform: translateY(100%);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast.success {
      background-color: var(--success);
    }

    .toast.error {
      background-color: var(--danger);
    }

    .toast.warning {
      background-color: var(--warning);
      color: var(--text);
    }

    .toast.info {
      background-color: var(--primary);
    }

    /* Dark Mode */
    .dark-mode {
      --bg: var(--dark-bg);
      --card: var(--dark-card);
      --text: var(--dark-text);
      --muted: var(--dark-muted);
      background-color: var(--dark-bg);
      color: var(--text);
    }

    .dark-mode .app {
      background-color: var(--dark-bg);
    }

    .dark-mode header,
    .dark-mode footer,
    .dark-mode .card {
      background: var(--dark-card);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .dark-mode .faq-question {
      background: var(--dark-card);
    }

    .dark-mode .note-card {
      background: var(--dark-card);
    }

    .dark-mode .favorite-item {
      background: var(--dark-card);
    }

    /* Responsive */
    @media (max-width: 480px) {
      .screen {
        padding: 15px;
      }

      .sentiments-grid {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      }

      .filter-tabs {
        flex-direction: column;
        align-items: center;
      }

      .filter-tab {
        width: 100%;
        justify-content: center;
      }

      .share-options {
        grid-template-columns: repeat(2, 1fr);
      }

      .mission-stats {
        gap: 15px;
      }

      .mission-stat {
        min-width: 100px;
      }
    }

    /* Utility Classes */
    .muted {
      color: var(--muted);
      font-size: 0.9em;
    }

    .text-center {
      text-align: center;
    }

    .flex {
      display: flex;
    }

    .flex-column {
      display: flex;
      flex-direction: column;
    }

    .flex-center {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .flex-between {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .gap-10 {
      gap: 10px;
    }

    .gap-20 {
      gap: 20px;
    }

    .mt-20 {
      margin-top: 20px;
    }

    .mb-20 {
      margin-bottom: 20px;
    }

    .w-100 {
      width: 100%;
    }

    /* Animations */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px) scaleY(0.9);
      }

      to {
        opacity: 1;
        transform: translateY(0) scaleY(1);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* ===== QUIZ & VIDEO STYLES ===== */
    .video-container {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      margin: 20px 0;
      border-radius: var(--radius);
      overflow: hidden;
    }

    .video-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .options-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin: 20px 0;
    }

    .option {
      padding: 12px;
      border: 1px solid var(--bg);
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      font-weight: 500;
      transition: all 0.2s;
      background-color: var(--bg);
      color: var(--text);
    }

    .option:hover {
      border-color: var(--primary);
      background-color: var(--bg);
    }

    .option.correct {
      background-color: var(--success) !important;
      color: white !important;
      border-color: var(--success) !important;
    }

    .option.wrong {
      background-color: var(--danger) !important;
      color: white !important;
      border-color: var(--danger) !important;
    }

    .option:disabled,
    .option[style*="pointer-events: none"] {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .quiz-step {
      margin-top: 20px;
    }

    .badge {
      background: var(--primary);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <!-- PWA Installation Banner -->
  <div id="pwa-install-banner" class="pwa-install-banner hidden">
    <div class="pwa-banner-content">
      <div class="pwa-icon">
        <i class="fas fa-download"></i>
      </div>
      <div class="pwa-text">
        <h4>Instalar App</h4>
        <p>Tenha acesso offline e ícone na tela inicial</p>
      </div>
    </div>
    <div class="pwa-banner-actions">
      <button class="pwa-btn" onclick="closeInstallBanner()">Fechar</button>
      <button class="pwa-btn install" onclick="installPWA()">Instalar</button>
    </div>
  </div>

  <!-- App Container -->
<div class="app" role="application" aria-label="App Conexão Pais e Filhos">
  <!-- Header -->
  <header>
    <div class="brand" onclick="nav('home')">
      <img src="https://tse3.mm.bing.net/th/id/OIP.2xBALJYhhVno3u98s_XItAHaHa?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3"
        alt="Logo Universidade de Pais" class="logo" />
      <div>
        <h1>Universidade de Pais</h1>
        <div class="muted">Conexão Pais e Filhos.</div>
      </div>
    </div>

    <div class="nav-actions">
      <button class="icon" id="menu-button" onclick="toggleMenu()" aria-label="Abrir menu">
        <i class="fas fa-bars"></i>
      </button>

      <div class="menu-dropdown" id="menu-dropdown">
        <div class="tab" onclick="nav('about')">
          <i class="fas fa-info-circle"></i> Sobre a Universidade
        </div>
        <div class="tab" onclick="nav('faq')">
          <i class="fas fa-question-circle"></i> FAQs/Fale Conosco
        </div>
        <div class="tab" onclick="nav('benefits')">
          <i class="fas fa-star"></i> Benefícios
        </div>
        <div class="tab" onclick="nav('sentiments')">
          <i class="fas fa-brain"></i> Lista de Emoções
        </div>
        <div class="tab" onclick="nav('notes')">
          <i class="fas fa-sticky-note"></i> Anotações
        </div>
        <div class="tab" onclick="nav('favorites')">
          <i class="fas fa-heart"></i> Favoritos
        </div>
        <div class="tab" onclick="nav('share')">
          <i class="fas fa-share-alt"></i> Compartilhar
        </div>
        <div class="tab" onclick="nav('profile')">
          <i class="fas fa-user-cog"></i> Configurações do Perfil
        </div>
        <div class="tab" onclick="exportUserData()">
          <i class="fas fa-download"></i> Exportar Dados
        </div>
        <div class="tab" onclick="clearAllData()" style="color: var(--danger);">
          <i class="fas fa-trash"></i> Limpar Todos os Dados
        </div>

        <!-- Ícones lado a lado, mais para cima (menos margem inferior) -->
        <div class="tab" style="display: flex; justify-content: center; align-items: center; gap: 40px; padding: 10px 0 14px 0; margin: 0;">
          <a href="../index.html" class="text-decoration-none" title="Voltar ao Portfólio MakerAI Studio" style="font-size: 1.7rem; color: var(--text);">
            <i class="fas fa-home"></i>
          </a>
          <a href="https://wa.me/5511999999999" target="_blank" rel="noopener" class="text-decoration-none text-success" title="Falar no WhatsApp" style="font-size: 1.9rem;">
            <i class="fab fa-whatsapp"></i>
          </a>
        </div>
      </div>
    </div>
  </header>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
      <!-- Signup -->
      <section id="screen-signup" class="screen card" style="display:none;text-align:center;">
        <h2 style="margin-top:0">Bem-vindo(a)!</h2>
        <p class="muted">Crie sua conta para acompanhar seu progresso no curso.</p>

        <div style="margin-bottom:15px;">
          <button class="btn ghost" onclick="handleExistingUser()">
            <i class="fas fa-user-check"></i> Já tenho conta
          </button>
        </div>

        <div class="signup-form" style="margin-top:12px;">
          <input type="text" id="signup-name" placeholder="Seu nome completo" required>
          <input type="email" id="signup-email" placeholder="seu@email.com" required>
          <button class="btn" onclick="saveInitialAccount()">
            <i class="fas fa-rocket"></i> Começar o Curso
          </button>
        </div>
      </section>

      <!-- Home -->
      <section id="screen-home" class="screen card" style="display:none">
        <div class="course-head"
          style="margin-bottom:12px;display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div class="muted">Módulos</div>
            <h2 style="margin:4px 0 0">Fortalecendo Laços Familiares</h2>
          </div>
          <div class="meta" style="font-size:0.9em;font-weight:600">32 Aulas</div>
        </div>
        <p class="muted">Um curso único para fortalecer laços familiares, ministrado pelo Dr. Wimer Bottura Jr.</p>

        <div class="modules" id="modules" style="margin-top:12px;">
          <!-- Modules serão renderizados via JS -->
        </div>
      </section>

      <!-- Profile (COMPLETO) -->
      <section id="screen-profile" class="screen card" style="display:none; text-align:center;">
        <h2 style="margin-top:0">
          <i class="fas fa-user-cog"></i> Configurações do Perfil
        </h2>

        <div class="profile-photo-section">
          <img id="profile-photo" src="https://via.placeholder.com/120/3a6ea5/FFFFFF?text=FP" alt="Foto do Perfil">
          <div style="display:flex;gap:8px;margin-top:10px; flex-wrap: wrap; justify-content: center;">
            <button class="btn ghost" onclick="document.getElementById('photo-input').click()">
              <i class="fas fa-camera"></i> Escolher Foto
            </button>
            <button class="btn ghost" onclick="removeProfilePhoto()">
              <i class="fas fa-trash"></i> Remover
            </button>
          </div>
          <input type="file" id="photo-input" accept="image/*" style="display:none;"
            onchange="updateProfilePhoto(event)">
        </div>

        <div class="form-group">
          <label for="profile-name">
            <i class="fas fa-user"></i> Nome
          </label>
          <input type="text" id="profile-name" placeholder="Digite seu nome completo" required>
        </div>

        <div class="form-group">
          <label for="profile-email">
            <i class="fas fa-envelope"></i> Email
          </label>
          <input type="email" id="profile-email" placeholder="Digite seu email de acesso" required>
        </div>

        <h3 style="margin-top:20px;">
          <i class="fas fa-sliders-h"></i> Preferências
        </h3>

        <div class="form-group toggle-group">
          <label for="dark-mode-toggle">
            <i class="fas fa-moon"></i> Modo Escuro
          </label>
          <label class="toggle-switch">
            <input type="checkbox" id="dark-mode-toggle" onchange="toggleDarkMode(this)">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="form-group toggle-group">
          <label for="notifications-toggle">
            <i class="fas fa-bell"></i> Notificações
          </label>
          <label class="toggle-switch">
            <input type="checkbox" id="notifications-toggle" onchange="handleNotificationToggle(this)">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="form-group toggle-group">
          <label for="reminders-toggle">
            <i class="fas fa-clock"></i> Lembretes Diários
          </label>
          <label class="toggle-switch">
            <input type="checkbox" id="reminders-toggle" onchange="handleReminderToggle(this)">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <!-- Estatísticas -->
        <div class="profile-stats card" style="margin-top:20px;">
          <h3 style="margin-top:0;">
            <i class="fas fa-chart-line"></i> Suas Estatísticas
          </h3>
          <div style="display:flex;justify-content:space-around;flex-wrap:wrap;">
            <div class="stat-item">
              <div id="stats-completed-profile" style="font-size:1.5em;font-weight:bold;color:var(--success)">0</div>
              <div style="font-size:0.8em;color:var(--muted)">Aulas Concluídas</div>
            </div>
            <div class="stat-item">
              <div id="stats-percentage-profile" style="font-size:1.5em;font-weight:bold;color:var(--primary)">0%</div>
              <div style="font-size:0.8em;color:var(--muted)">Progresso</div>
            </div>
            <div class="stat-item">
              <div id="stats-favorites-profile" style="font-size:1.5em;font-weight:bold;color:var(--danger)">0</div>
              <div style="font-size:0.8em;color:var(--muted)">Favoritos</div>
            </div>
          </div>
        </div>

        <div style="margin-top:20px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
          <button class="btn" onclick="saveAccountSettings()">
            <i class="fas fa-save"></i> Salvar Configurações
          </button>
          <button class="btn ghost" onclick="exportUserData()">
            <i class="fas fa-download"></i> Exportar Dados
          </button>
        </div>
      </section>

      <!-- About (COMPLETO) -->
      <section id="screen-about" class="screen card" style="display:none">
        <h2 style="margin-top:0;color:var(--primary);">
          <i class="fas fa-info-circle"></i> Sobre a Universidade
        </h2>

        <div class="about-content">
          <div class="about-section">
            <h3>Nossa Missão</h3>
            <p>Transformar famílias através da educação parental, oferecendo ferramentas práticas e conhecimento
              científico para fortalecer laços familiares e melhorar a comunicação entre pais e filhos.</p>
          </div>

          <div class="mission-stats">
            <div class="mission-stat">
              <div class="mission-stat-number">2,500+</div>
              <div class="mission-stat-label">Famílias Transformadas</div>
            </div>
            <div class="mission-stat">
              <div class="mission-stat-number">98%</div>
              <div class="mission-stat-label">Satisfação</div>
            </div>
            <div class="mission-stat">
              <div class="mission-stat-number">15</div>
              <div class="mission-stat-label">Anos de Experiência</div>
            </div>
          </div>

          <div class="about-section">
            <h3>Nossa História</h3>
            <p>Fundada em 2009 pelo Dr. Wimer Bottura Jr., a Universidade de Pais surgiu da necessidade de oferecer
              educação parental acessível e baseada em evidências científicas. Começamos com um pequeno grupo de 20
              famílias e hoje impactamos milhares em todo o Brasil.</p>
          </div>

          <div class="about-section">
            <h3>Nossa Metodologia</h3>
            <p>Combinamos neurociência, psicologia do desenvolvimento e terapia familiar em um programa prático e
              aplicável no dia a dia. Cada módulo foi desenvolvido com base em pesquisas científicas e testado em
              famílias reais.</p>
          </div>

          <div class="about-section">
            <h3>Equipe</h3>
            <p>Nossa equipe é composta por psicólogos, terapeutas familiares, educadores e pesquisadores com ampla
              experiência em desenvolvimento infantil e relações familiares.</p>
          </div>

          <div class="about-section">
            <h3>Reconhecimentos</h3>
            <ul style="padding-left:20px;margin-top:10px;">
              <li>Prêmio Educação Familiar 2022</li>
              <li>Certificado de Excelência em Educação Parental</li>
              <li>Reconhecimento do Conselho de Psicologia</li>
              <li>Parceria com Universidades Internacionais</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- FAQ (COMPLETO) -->
      <section id="screen-faq" class="screen card" style="display:none">
        <h2 style="margin-top:0;color:var(--primary);">
          <i class="fas fa-question-circle"></i> FAQs / Fale Conosco
        </h2>

        <div class="faq-section">
          <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
              <span>Como acesso o curso completo?</span>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
              <p>Este é um curso demonstrativo. Para acessar o curso completo com todos os 32 módulos, entre em contato
                pelo email contato@universidadedepais.com ou pelo telefone (11) 99999-9999.</p>
            </div>
          </div>

          <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
              <span>O curso é reconhecido?</span>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
              <p>Sim, nosso curso possui certificação reconhecida pelo Conselho de Educação Parental e é validado por
                instituições internacionais de psicologia familiar.</p>
            </div>
          </div>

          <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
              <span>Quanto tempo tenho acesso?</span>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
              <p>O acesso é vitalício! Uma vez matriculado, você terá acesso permanente a todas as atualizações e novos
                conteúdos do curso.</p>
            </div>
          </div>

          <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
              <span>Funciona em qualquer dispositivo?</span>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
              <p>Sim! Nosso curso é 100% responsivo e funciona em smartphones, tablets, computadores e smart TVs. Você
                pode inclusive instalar como aplicativo no seu celular.</p>
            </div>
          </div>

          <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
              <span>Existe suporte durante o curso?</span>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
              <p>Sim! Oferecemos suporte por email, WhatsApp e encontros online semanais com nossa equipe de
                especialistas.</p>
            </div>
          </div>
        </div>

        <!-- Formulário de Contato -->
        <div class="contact-form card" style="margin-top:30px;">
          <h3 style="margin-top:0;">
            <i class="fas fa-envelope"></i> Fale Conosco
          </h3>
          <p class="muted" style="margin-bottom:15px;">Tem alguma dúvida? Entre em contato conosco!</p>

          <div class="form-group">
            <label for="contact-name">
              <i class="fas fa-user"></i> Seu Nome
            </label>
            <input type="text" id="contact-name" placeholder="Digite seu nome">
          </div>

          <div class="form-group">
            <label for="contact-email">
              <i class="fas fa-envelope"></i> Seu Email
            </label>
            <input type="email" id="contact-email" placeholder="seu@email.com">
          </div>

          <div class="form-group">
            <label for="contact-message">
              <i class="fas fa-comment"></i> Sua Mensagem
            </label>
            <textarea id="contact-message" placeholder="Digite sua mensagem aqui..." rows="4"></textarea>
          </div>

          <button class="btn" onclick="sendContactMessage()">
            <i class="fas fa-paper-plane"></i> Enviar Mensagem
          </button>

          <div class="contact-info" style="margin-top:20px;padding-top:20px;border-top:1px solid var(--bg);">
            <p style="margin-bottom:8px;"><strong>Outras formas de contato:</strong></p>
            <div style="display:flex;flex-direction:column;gap:8px;">
              <div style="display:flex;align-items:center;gap:10px;">
                <i class="fas fa-phone" style="color:var(--primary);"></i>
                <span>(11) 99999-9999</span>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <i class="fas fa-envelope" style="color:var(--primary);"></i>
                <span>contato@universidadedepais.com</span>
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <i class="fas fa-clock" style="color:var(--primary);"></i>
                <span>Segunda a Sexta, 9h às 18h</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Benefits (COMPLETO) -->
      <section id="screen-benefits" class="screen card" style="display:none">
        <div class="benefits-header" style="text-align:center;margin-bottom:30px;">
          <h2 style="margin-top:0;color:var(--primary);">
            <i class="fas fa-star"></i> Benefícios do Curso
          </h2>
          <p class="muted" style="max-width:600px;margin:0 auto;">Descubra os principais ganhos ao completar o programa
          </p>

          <!-- Estatísticas -->
          <div class="benefits-stats"
            style="display:flex;justify-content:center;gap:30px;margin-top:20px;flex-wrap:wrap;">
            <div class="stat-item" style="text-align:center;">
              <div style="font-size:2em;font-weight:bold;color:var(--secondary);">89%</div>
              <div style="font-size:0.8em;color:var(--muted);">Melhora na comunicação</div>
            </div>
            <div class="stat-item" style="text-align:center;">
              <div style="font-size:2em;font-weight:bold;color:var(--secondary);">76%</div>
              <div style="font-size:0.8em;color:var(--muted);">Redução de conflitos</div>
            </div>
            <div class="stat-item" style="text-align:center;">
              <div style="font-size:2em;font-weight:bold;color:var(--secondary);">94%</div>
              <div style="font-size:0.8em;color:var(--muted);">Satisfação dos pais</div>
            </div>
          </div>
        </div>

        <!-- Filtros -->
        <div class="benefits-filters">
          <div class="filter-tabs">
            <button class="filter-tab active" onclick="filterBenefits('all')">
              <i class="fas fa-star"></i> Todos
            </button>
            <button class="filter-tab" onclick="filterBenefits('comunicacao')">
              <i class="fas fa-comments"></i> Comunicação
            </button>
            <button class="filter-tab" onclick="filterBenefits('relacionamento')">
              <i class="fas fa-heart"></i> Relacionamento
            </button>
            <button class="filter-tab" onclick="filterBenefits('desenvolvimento')">
              <i class="fas fa-brain"></i> Desenvolvimento
            </button>
          </div>
        </div>

        <!-- Grid de Benefícios -->
        <div class="benefits-grid" id="benefits-grid">
          <!-- COMUNICAÇÃO -->
          <div class="benefit-card comunicacao" data-category="comunicacao">
            <div class="benefit-icon">
              <i class="fas fa-comments"></i>
            </div>
            <div class="benefit-content">
              <h3>Comunicação Clara e Efetiva</h3>
              <p>Aprenda a expressar suas necessidades e a ouvir seus filhos de forma que ambos se sintam compreendidos.
              </p>
              <ul class="benefit-features">
                <li>Escuta ativa e empática</li>
                <li>Expressão assertiva de sentimentos</li>
                <li>Diálogo sem julgamentos</li>
              </ul>
              <div class="benefit-meta">
                <span class="benefit-duration"><i class="fas fa-clock"></i> Aulas 2-5</span>
                <span class="benefit-level"><i class="fas fa-lightbulb"></i> Fundamental</span>
              </div>
            </div>
          </div>

          <!-- RELACIONAMENTO -->
          <div class="benefit-card relacionamento" data-category="relacionamento">
            <div class="benefit-icon">
              <i class="fas fa-heart"></i>
            </div>
            <div class="benefit-content">
              <h3>Vínculos Fortalecidos</h3>
              <p>Construa relacionamentos mais profundos e significativos com seus filhos através da conexão emocional
                genuína.</p>
              <ul class="benefit-features">
                <li>Confiança e segurança emocional</li>
                <li>Respeito mútuo e empatia</li>
                <li>Memórias familiares positivas</li>
              </ul>
              <div class="benefit-meta">
                <span class="benefit-duration"><i class="fas fa-clock"></i> Aulas 6-9</span>
                <span class="benefit-level"><i class="fas fa-lightbulb"></i> Intermediário</span>
              </div>
            </div>
          </div>

          <!-- DESENVOLVIMENTO -->
          <div class="benefit-card desenvolvimento" data-category="desenvolvimento">
            <div class="benefit-icon">
              <i class="fas fa-brain"></i>
            </div>
            <div class="benefit-content">
              <h3>Desenvolvimento Emocional</h3>
              <p>Ajude seus filhos a desenvolverem inteligência emocional, resiliência e habilidades sociais essenciais
                para a vida.</p>
              <ul class="benefit-features">
                <li>Autoconhecimento e autoestima</li>
                <li>Gestão de emoções complexas</li>
                <li>Resolução pacífica de conflitos</li>
              </ul>
              <div class="benefit-meta">
                <span class="benefit-duration"><i class="fas fa-clock"></i> Aulas 10-13</span>
                <span class="benefit-level"><i class="fas fa-lightbulb"></i> Avançado</span>
              </div>
            </div>
          </div>

          <!-- HARMONIA FAMILIAR -->
          <div class="benefit-card comunicacao" data-category="comunicacao">
            <div class="benefit-icon">
              <i class="fas fa-home"></i>
            </div>
            <div class="benefit-content">
              <h3>Harmonia Familiar</h3>
              <p>Crie um ambiente familiar pacífico onde todos se sintam ouvidos, valorizados e apoiados.</p>
              <ul class="benefit-features">
                <li>Redução de conflitos domésticos</li>
                <li>Ambiente seguro para expressão</li>
                <li>Cooperação e trabalho em equipe</li>
              </ul>
              <div class="benefit-meta">
                <span class="benefit-duration"><i class="fas fa-clock"></i> Aulas 14-17</span>
                <span class="benefit-level"><i class="fas fa-lightbulb"></i> Fundamental</span>
              </div>
            </div>
          </div>

          <!-- AUTOCONFIANÇA -->
          <div class="benefit-card relacionamento" data-category="relacionamento">
            <div class="benefit-icon">
              <i class="fas fa-rocket"></i>
            </div>
            <div class="benefit-content">
              <h3>Autoconfiança Parental</h3>
              <p>Ganhe segurança em suas decisões parentais e confiança em sua capacidade de educar e guiar seus filhos.
              </p>
              <ul class="benefit-features">
                <li>Tomada de decisão assertiva</li>
                <li>Estabelecimento de limites saudáveis</li>
                <li>Autonomia e liderança familiar</li>
              </ul>
              <div class="benefit-meta">
                <span class="benefit-duration"><i class="fas fa-clock"></i> Aulas 18-21</span>
                <span class="benefit-level"><i class="fas fa-lightbulb"></i> Intermediário</span>
              </div>
            </div>
          </div>

          <!-- LEGADO FAMILIAR -->
          <div class="benefit-card desenvolvimento" data-category="desenvolvimento">
            <div class="benefit-icon">
              <i class="fas fa-seedling"></i>
            </div>
            <div class="benefit-content">
              <h3>Legado Familiar Positivo</h3>
              <p>Construa um legado de valores, princípios e memórias que serão levados por gerações.</p>
              <ul class="benefit-features">
                <li>Transmissão de valores familiares</li>
                <li>Tradições e rituais significativos</li>
                <li>Base sólida para o futuro</li>
              </ul>
              <div class="benefit-meta">
                <span class="benefit-duration"><i class="fas fa-clock"></i> Aulas 22-25</span>
                <span class="benefit-level"><i class="fas fa-lightbulb"></i> Avançado</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Depoimentos -->
        <div class="testimonials-section"
          style="margin-top:40px;padding:30px;background:var(--bg);border-radius:var(--radius);">
          <h3 style="text-align:center;margin-bottom:25px;">
            <i class="fas fa-quote-left"></i> O que os pais estão dizendo:
          </h3>
          <div class="testimonials-grid">
            <div class="testimonial-card">
              <div class="testimonial-text">
                "O curso transformou nossa comunicação familiar. Finalmente entendemos o que nossos filhos realmente
                precisam!"
              </div>
              <div class="testimonial-author">
                <i class="fas fa-user"></i> Ana Silva, mãe de 2 filhos
              </div>
            </div>
            <div class="testimonial-card">
              <div class="testimonial-text">
                "As técnicas de resolução de conflitos reduziram nossas brigas em 80%. Valeu cada minuto do curso!"
              </div>
              <div class="testimonial-author">
                <i class="fas fa-user"></i> Carlos Oliveira, pai adolescente
              </div>
            </div>
            <div class="testimonial-card">
              <div class="testimonial-text">
                "Aprendi a validar as emoções dos meus filhos e isso mudou completamente nosso relacionamento.
                Gratidão!"
              </div>
              <div class="testimonial-author">
                <i class="fas fa-user"></i> Mariana Costa, mãe de 3
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Sentiments (COMPLETO) -->
      <section id="screen-sentiments" class="screen card" style="display:none">
        <h2 style="margin-top:0">
          <i class="fas fa-brain"></i> Lista de Emoções
        </h2>
        <p class="muted">Ferramenta essencial para ajudar você e seu filho a nomear e validar o que estão sentindo.</p>

        <!-- Filtros -->
        <div class="filters-container">
          <button class="filter-btn active" onclick="filterEmotions('all')">
            <i class="fas fa-layer-group"></i> Todas
          </button>
          <button class="filter-btn" onclick="filterEmotions('positive')">
            <i class="fas fa-smile"></i> Positivas
          </button>
          <button class="filter-btn" onclick="filterEmotions('neutral')">
            <i class="fas fa-meh"></i> Neutras
          </button>
          <button class="filter-btn" onclick="filterEmotions('negative')">
            <i class="fas fa-frown"></i> Desafiadoras
          </button>
        </div>

        <!-- Grid de Emoções -->
        <div class="sentiments-grid" id="sentiments-grid">
          <!-- Emoções Positivas -->
          <div class="sentiment-card success" data-category="positive">
            <div class="emotion-icon">😊</div>
            <div class="emotion-text">
              <strong>Alegria</strong>
              <span class="emotion-desc">Contentamento, felicidade</span>
            </div>
          </div>

          <div class="sentiment-card success" data-category="positive">
            <div class="emotion-icon">😌</div>
            <div class="emotion-text">
              <strong>Paz</strong>
              <span class="emotion-desc">Tranquilidade, serenidade</span>
            </div>
          </div>

          <div class="sentiment-card success" data-category="positive">
            <div class="emotion-icon">😄</div>
            <div class="emotion-text">
              <strong>Entusiasmo</strong>
              <span class="emotion-desc">Animação, excitação</span>
            </div>
          </div>

          <div class="sentiment-card success" data-category="positive">
            <div class="emotion-icon">🤗</div>
            <div class="emotion-text">
              <strong>Carinho</strong>
              <span class="emotion-desc">Afeto, aconchego</span>
            </div>
          </div>

          <div class="sentiment-card success" data-category="positive">
            <div class="emotion-icon">😇</div>
            <div class="emotion-text">
              <strong>Gratidão</strong>
              <span class="emotion-desc">Agradecimento, reconhecimento</span>
            </div>
          </div>

          <div class="sentiment-card success" data-category="positive">
            <div class="emotion-icon">🥰</div>
            <div class="emotion-text">
              <strong>Amor</strong>
              <span class="emotion-desc">Afeição, conexão profunda</span>
            </div>
          </div>

          <div class="sentiment-card success" data-category="positive">
            <div class="emotion-icon">😎</div>
            <div class="emotion-text">
              <strong>Confiança</strong>
              <span class="emotion-desc">Segurança, autoestima</span>
            </div>
          </div>

          <div class="sentiment-card success" data-category="positive">
            <div class="emotion-icon">🎉</div>
            <div class="emotion-text">
              <strong>Celebração</strong>
              <span class="emotion-desc">Festa, conquista</span>
            </div>
          </div>

          <!-- Emoções Neutras -->
          <div class="sentiment-card neutral" data-category="neutral">
            <div class="emotion-icon">😐</div>
            <div class="emotion-text">
              <strong>Neutro</strong>
              <span class="emotion-desc">Equilíbrio, indiferença</span>
            </div>
          </div>

          <div class="sentiment-card neutral" data-category="neutral">
            <div class="emotion-icon">🤔</div>
            <div class="emotion-text">
              <strong>Pensativo</strong>
              <span class="emotion-desc">Reflexão, contemplação</span>
            </div>
          </div>

          <div class="sentiment-card neutral" data-category="neutral">
            <div class="emotion-icon">😶</div>
            <div class="emotion-text">
              <strong>Surpreso</strong>
              <span class="emotion-desc">Espanto, incredulidade</span>
            </div>
          </div>

          <div class="sentiment-card neutral" data-category="neutral">
            <div class="emotion-icon">🧐</div>
            <div class="emotion-text">
              <strong>Curioso</strong>
              <span class="emotion-desc">Interesse, investigação</span>
            </div>
          </div>

          <!-- Emoções Desafiadoras -->
          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😟</div>
            <div class="emotion-text">
              <strong>Preocupação</strong>
              <span class="emotion-desc">Inquietação, ansiedade</span>
            </div>
          </div>

          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😕</div>
            <div class="emotion-text">
              <strong>Confusão</strong>
              <span class="emotion-desc">Dúvida, incerteza</span>
            </div>
          </div>

          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😞</div>
            <div class="emotion-text">
              <strong>Tristeza</strong>
              <span class="emotion-desc">Desânimo, melancolia</span>
            </div>
          </div>

          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😔</div>
            <div class="emotion-text">
              <strong>Desapontamento</strong>
              <span class="emotion-desc">Frustração, letdown</span>
            </div>
          </div>

          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😣</div>
            <div class="emotion-text">
              <strong>Frustração</strong>
              <span class="emotion-desc">Irritação, impaciência</span>
            </div>
          </div>

          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😠</div>
            <div class="emotion-text">
              <strong>Raiva</strong>
              <span class="emotion-desc">Ira, indignação</span>
            </div>
          </div>

          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😢</div>
            <div class="emotion-text">
              <strong>Chateado</strong>
              <span class="emotion-desc">Mágoa, pesar</span>
            </div>
          </div>

          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😨</div>
            <div class="emotion-text">
              <strong>Medo</strong>
              <span class="emotion-desc">Temor, apreensão</span>
            </div>
          </div>

          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😰</div>
            <div class="emotion-text">
              <strong>Ansiedade</strong>
              <span class="emotion-desc">Nervosismo, tensão</span>
            </div>
          </div>

          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😩</div>
            <div class="emotion-text">
              <strong>Exaustão</strong>
              <span class="emotion-desc">Cansaço, esgotamento</span>
            </div>
          </div>

          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😤</div>
            <div class="emotion-text">
              <strong>Impaciência</strong>
              <span class="emotion-desc">Irritação, intolerância</span>
            </div>
          </div>

          <div class="sentiment-card danger" data-category="negative">
            <div class="emotion-icon">😭</div>
            <div class="emotion-text">
              <strong>Angústia</strong>
              <span class="emotion-desc">Sofrimento, desespero</span>
            </div>
          </div>
        </div>

        <!-- Estatísticas -->
        <div class="emotion-stats"
          style="margin-top:20px;padding:15px;background:var(--bg);border-radius:var(--radius);">
          <div style="display:flex;justify-content:space-around;flex-wrap:wrap;">
            <div class="stat-item">
              <div style="font-size:1.5em;font-weight:bold;color:var(--success)">8</div>
              <div style="font-size:0.8em;color:var(--muted)">Positivas</div>
            </div>
            <div class="stat-item">
              <div style="font-size:1.5em;font-weight:bold;color:var(--warning)">4</div>
              <div style="font-size:0.8em;color:var(--muted)">Neutras</div>
            </div>
            <div class="stat-item">
              <div style="font-size:1.5em;font-weight:bold;color:var(--danger)">12</div>
              <div style="font-size:0.8em;color:var(--muted)">Desafiadoras</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Notes (COMPLETO) -->
      <section id="screen-notes" class="screen card" style="display:none">
        <h2 style="margin-top:0;color:var(--primary);">
          <i class="fas fa-sticky-note"></i> Anotações Pessoais
        </h2>
        <p class="muted">Registre suas reflexões, aprendizados e insights durante o curso.</p>

        <div class="notes-container">
          <!-- Editor de Notas -->
          <div class="note-editor card">
            <h3 style="margin-top:0;">Nova Anotação</h3>
            <div class="form-group">
              <label for="note-title">
                <i class="fas fa-heading"></i> Título
              </label>
              <input type="text" id="note-title" placeholder="Dê um título para sua anotação">
            </div>

            <div class="form-group">
              <label for="note-content">
                <i class="fas fa-edit"></i> Conteúdo
              </label>
              <textarea id="note-content" placeholder="Escreva suas anotações aqui..." rows="4"></textarea>
            </div>

            <div class="form-group">
              <label for="note-tags">
                <i class="fas fa-tags"></i> Tags (separadas por vírgula)
              </label>
              <input type="text" id="note-tags" placeholder="ex: comunicação, filhos, limites">
            </div>

            <div style="display:flex;gap:10px;margin-top:15px;">
              <button class="btn" onclick="saveNote()">
                <i class="fas fa-save"></i> Salvar Anotação
              </button>
              <button class="btn ghost" onclick="clearNoteForm()">
                <i class="fas fa-times"></i> Limpar
              </button>
            </div>
          </div>

          <!-- Lista de Notas -->
          <div class="notes-list" id="notes-list">
            <!-- Notas serão carregadas aqui -->
          </div>
        </div>
      </section>

      <!-- Favorites (COMPLETO) -->
      <section id="screen-favorites" class="screen card" style="display:none">
        <h2 style="margin-top:0;color:var(--primary);">
          <i class="fas fa-heart"></i> Seus Favoritos
        </h2>
        <p class="muted">Aulas e conteúdos que você marcou como favoritos.</p>

        <div class="favorites-grid" id="favorites-grid">
          <!-- Favoritos serão carregados aqui -->
        </div>

        <div id="empty-favorites" style="text-align:center;padding:40px 20px;display:none;">
          <div style="font-size:4em;margin-bottom:20px;color:var(--muted);opacity:0.5;">
            <i class="fas fa-heart"></i>
          </div>
          <h3 style="margin-bottom:10px;color:var(--muted);">Nenhum favorito ainda</h3>
          <p class="muted">Explore as aulas e marque seus conteúdos favoritos clicando no ❤️</p>
          <button class="btn" onclick="nav('home')" style="margin-top:20px;">
            <i class="fas fa-search"></i> Explorar Aulas
          </button>
        </div>
      </section>

      <!-- Share (COMPLETO) -->
      <section id="screen-share" class="screen card" style="display:none">
        <h2 style="margin-top:0;color:var(--primary);">
          <i class="fas fa-share-alt"></i> Compartilhar Curso
        </h2>
        <p class="muted">Compartilhe o curso com amigos e familiares que também podem se beneficiar.</p>

        <div class="share-options">
          <div class="share-option" onclick="shareViaWhatsApp()">
            <div class="share-icon whatsapp">
              <i class="fab fa-whatsapp"></i>
            </div>
            <div class="share-text">WhatsApp</div>
          </div>

          <div class="share-option" onclick="shareViaFacebook()">
            <div class="share-icon facebook">
              <i class="fab fa-facebook-f"></i>
            </div>
            <div class="share-text">Facebook</div>
          </div>

          <div class="share-option" onclick="shareViaInstagram()">
            <div class="share-icon instagram">
              <i class="fab fa-instagram"></i>
            </div>
            <div class="share-text">Instagram</div>
          </div>

          <div class="share-option" onclick="shareViaEmail()">
            <div class="share-icon email">
              <i class="fas fa-envelope"></i>
            </div>
            <div class="share-text">Email</div>
          </div>

          <div class="share-option" onclick="copyShareLink()">
            <div class="share-icon copy">
              <i class="fas fa-copy"></i>
            </div>
            <div class="share-text">Copiar Link</div>
          </div>
        </div>

        <!-- Código de Convite -->
        <div class="invite-code card" style="margin-top:30px;">
          <h3 style="margin-top:0;">
            <i class="fas fa-gift"></i> Código de Convite
          </h3>
          <p class="muted" style="margin-bottom:15px;">Compartilhe seu código para dar 15% de desconto a amigos:</p>

          <div
            style="background:var(--bg);padding:15px;border-radius:var(--radius);text-align:center;margin-bottom:15px;">
            <div
              style="font-family:monospace;font-size:1.5em;font-weight:bold;letter-spacing:2px;color:var(--primary);">
              FAMILIA-UP2024
            </div>
            <div style="font-size:0.85em;color:var(--muted);margin-top:5px;">
              Válido por 30 dias | 15% de desconto
            </div>
          </div>

          <button class="btn" onclick="copyInviteCode()" style="width:100%;">
            <i class="fas fa-copy"></i> Copiar Código
          </button>
        </div>

        <!-- Estatísticas de Compartilhamento -->
        <div class="share-stats card" style="margin-top:20px;">
          <h3 style="margin-top:0;">
            <i class="fas fa-chart-bar"></i> Seu Impacto
          </h3>
          <div style="display:flex;justify-content:space-around;text-align:center;flex-wrap:wrap;">
            <div class="stat-item">
              <div id="share-count" style="font-size:1.5em;font-weight:bold;color:var(--primary)">0</div>
              <div style="font-size:0.8em;color:var(--muted)">Compartilhamentos</div>
            </div>
            <div class="stat-item">
              <div id="referral-count" style="font-size:1.5em;font-weight:bold;color:var(--success)">0</div>
              <div style="font-size:0.8em;color:var(--muted)">Indicações</div>
            </div>
            <div class="stat-item">
              <div id="impact-score" style="font-size:1.5em;font-weight:bold;color:var(--secondary)">0</div>
              <div style="font-size:0.8em;color:var(--muted)">Pontos de Impacto</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Aulas -->
      <section id="screen-aulas" class="screen card" style="display:none">
        <h2 id="aulas-title" style="margin-top:0">Aulas</h2>
        <div id="aulas-content">
          <!-- Aulas serão renderizadas via JS -->
        </div>
      </section>

      <!-- Aula Individual -->
      <section id="screen-aula" class="screen" style="display:none">
        <div id="aula-content">
          <!-- Conteúdo da aula será renderizado via JS -->
        </div>
      </section>

      <!-- Aula Concluída -->
      <section id="screen-complete" class="screen card" style="display:none;text-align:center">
        <h2>Parabéns!</h2>
        <p class="muted">Aula concluída com sucesso!</p>
      </section>

    </main>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Footer -->
    <footer>
      <div class="nav-item active" id="nav-home" onclick="nav('home')">
        <div class="nav-icon"><i class="fas fa-home"></i></div><span>Início</span>
      </div>
      <div class="nav-item" id="nav-benefits" onclick="nav('benefits')">
        <div class="nav-icon"><i class="fas fa-star"></i></div><span>Benefícios</span>
      </div>
      <div class="nav-item" id="nav-sentiments" onclick="nav('sentiments')">
        <div class="nav-icon"><i class="fas fa-brain"></i></div><span>Emoções</span>
      </div>
      <div class="nav-item" id="nav-profile" onclick="nav('profile')">
        <div class="nav-icon"><i class="fas fa-user"></i></div><span>Perfil</span>
      </div>
    </footer>
  </div>

  <script>
    // ===== DADOS DO CURSO =====
    const COURSE_MODULES = [
      {
        id: 0,
        title: "Módulo 1: Tranquilizando os Pais",
        description: "Acalmando preocupações comuns dos pais e fortalecendo a base familiar.",
        image: "https://i.pinimg.com/736x/0b/57/da/0b57dab511ce87d28abac1d7924e866d.jpg",
        aulas: [
          {
            id: 0,
            title: "Aula 1: Introdução à Comunicação Familiar",
            description: "Entendendo os fundamentos da comunicação eficaz",
            video: "https://www.youtube.com/embed/hB1UNt93FN8?rel=0",
            duration: "12:30",
            quizId: 0
          },
          {
            id: 1,
            title: "Aula 2: Escuta Ativa",
            description: "Técnicas para ouvir verdadeiramente seus filhos",
            video: "https://www.youtube.com/embed/dQw4w9WgXcQ?rel=0",
            duration: "15:45",
            quizId: 1
          }
        ]
      },
      {
        id: 1,
        title: "Módulo 2: Conectando com o Adolescente",
        description: "Técnicas avançadas de escuta, empatia e validação de sentimentos.",
        image: "https://i.pinimg.com/736x/da/0c/83/da0c83747f596db117ee11efebaf20c6.jpg",
        aulas: [
          {
            id: 0,
            title: "Aula 1: Entendendo a Adolescência",
            description: "Compreendendo as mudanças físicas e emocionais",
            video: "https://www.youtube.com/embed/hB1UNt93FN8?rel=0",
            duration: "18:20",
            quizId: 2
          }
        ]
      }
    ];

    const QUIZZES = [
      {
        id: 0,
        title: "Quiz: Comunicação Familiar",
        steps: [
          {
            question: "Qual é a técnica mais eficaz para ouvir seus filhos?",
            options: [
              "Interromper para dar conselhos",
              "Escuta ativa com empatia",
              "Ignorar quando estão chateados",
              "Dar sermões sobre comportamento"
            ],
            answer: 1,
            explanation: "A escuta ativa com empatia permite que a criança se sinta compreendida e valorizada."
          },
          {
            question: "Como validar os sentimentos de uma criança?",
            options: [
              "Dizer 'não fique triste'",
              "Minimizar o problema",
              "Repetir o que ela sente e acolher",
              "Distraí-la com outra coisa"
            ],
            answer: 2,
            explanation: "Repetir o que a criança sente mostra que você a compreende e aceita suas emoções."
          }
        ]
      },
      {
        id: 1,
        title: "Quiz: Escuta Ativa",
        steps: [
          {
            question: "Qual elemento NÃO faz parte da escuta ativa?",
            options: [
              "Contato visual",
              "Parafrasear o que foi dito",
              "Julgamento prematuro",
              "Perguntas abertas"
            ],
            answer: 2,
            explanation: "Julgamento prematuro prejudica a comunicação e faz a criança se sentir julgada."
          }
        ]
      }
    ];

    // ===== CONFIGURAÇÃO =====
    const APP_CONFIG = {
      NAME: 'Universidade de Pais',
      VERSION: '4.0.0',
      STORAGE_PREFIX: 'up_'
    };

    // ===== GESTORES =====
    let appState;
    let pwaManager;

    // ===== APP STATE =====
    class AppStateManager {
      constructor() {
        this.state = {
          currentScreen: 'signup',
          moduleIndex: 0,
          aulaIndex: 0,
          currentQuizStep: 0,
          quizScores: {},
          completedAulas: {},
          bookmarkedAulas: [],
          searchQuery: '',
          notes: [],
          shareStats: {
            count: 0,
            referrals: 0,
            impactScore: 0
          },
          account: {
            name: '',
            email: '',
            notifications: true,
            reminders: false,
            darkMode: false,
            createdAt: new Date().toISOString()
          },
          stats: {
            totalTimeSpent: 0,
            streak: 0,
            lastLogin: new Date().toISOString(),
            appLaunches: 0
          }
        };

        this.loadState();
        this.setupAutoSave();
        this.trackAppLaunch();
      }

      loadState() {
        try {
          const savedState = localStorage.getItem(`${APP_CONFIG.STORAGE_PREFIX}appState`);
          if (savedState) {
            const parsed = JSON.parse(savedState);
            this.state = { ...this.state, ...parsed };

            // Inicializar arrays se não existirem
            if (!this.state.notes) this.state.notes = [];
            if (!this.state.shareStats) this.state.shareStats = { count: 0, referrals: 0, impactScore: 0 };
            if (!this.state.bookmarkedAulas) this.state.bookmarkedAulas = [];

            if (this.state.account.name && this.state.account.email) {
              this.state.currentScreen = 'home';
            }
          }
        } catch (error) {
          console.error('Erro ao carregar estado:', error);
        }
      }

      saveState() {
        try {
          this.state.stats.lastActivity = new Date().toISOString();
          localStorage.setItem(`${APP_CONFIG.STORAGE_PREFIX}appState`,
            JSON.stringify(this.state));
        } catch (error) {
          console.error('Erro ao salvar estado:', error);
        }
      }

      setupAutoSave() {
        setInterval(() => this.saveState(), 30000);
        window.addEventListener('beforeunload', () => this.saveState());
      }

      trackAppLaunch() {
        this.state.stats.appLaunches = (this.state.stats.appLaunches || 0) + 1;
        this.state.stats.lastLogin = new Date().toISOString();
        this.saveState();
      }

      getProgress() {
        const totalAulas = 32;
        const completed = Object.keys(this.state.completedAulas || {}).length;
        const percentage = Math.round((completed / totalAulas) * 100);

        return {
          completedCount: completed,
          totalCount: totalAulas,
          percentage: percentage
        };
      }

      addNote(note) {
        if (!this.state.notes) this.state.notes = [];
        this.state.notes.unshift({
          id: Date.now(),
          ...note,
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        });
        this.saveState();
      }

      updateNote(id, updates) {
        const noteIndex = this.state.notes.findIndex(n => n.id === id);
        if (noteIndex !== -1) {
          this.state.notes[noteIndex] = {
            ...this.state.notes[noteIndex],
            ...updates,
            updatedAt: new Date().toISOString()
          };
          this.saveState();
          return true;
        }
        return false;
      }

      deleteNote(id) {
        const initialLength = this.state.notes.length;
        this.state.notes = this.state.notes.filter(n => n.id !== id);
        if (this.state.notes.length < initialLength) {
          this.saveState();
          return true;
        }
        return false;
      }

      incrementShareStats(type = 'share') {
        if (!this.state.shareStats) {
          this.state.shareStats = { count: 0, referrals: 0, impactScore: 0 };
        }

        switch (type) {
          case 'share':
            this.state.shareStats.count++;
            this.state.shareStats.impactScore += 10;
            break;
          case 'referral':
            this.state.shareStats.referrals++;
            this.state.shareStats.impactScore += 50;
            break;
        }

        this.saveState();
      }

      getBookmarkedItems() {
        if (!this.state.bookmarkedAulas || this.state.bookmarkedAulas.length === 0) {
          return [];
        }

        const bookmarkedItems = [];
        this.state.bookmarkedAulas.forEach(key => {
          const [moduleId, aulaId] = key.split('-').map(Number);
          const module = COURSE_MODULES[moduleId];
          if (module && module.aulas[aulaId]) {
            const aula = module.aulas[aulaId];
            bookmarkedItems.push({
              moduleId,
              aulaId,
              moduleTitle: module.title,
              aulaTitle: aula.title,
              description: aula.description,
              duration: aula.duration
            });
          }
        });

        return bookmarkedItems;
      }
    }

    // ===== PWA MANAGER =====
    class PWAInstallManager {
      constructor() {
        this.deferredPrompt = null;
        this.isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
          window.navigator.standalone;
        this.init();
      }

      init() {
        if (this.isStandalone) return;

        // Para iOS
        if (window.navigator.standalone === true) {
          this.isStandalone = true;
          return;
        }

        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          this.deferredPrompt = e;
          setTimeout(() => this.showInstallBanner(), 2000);
        });

        window.addEventListener('appinstalled', () => {
          console.log('App instalado!');
          this.hideInstallBanner();
          toast('🎉 App instalado na tela inicial!', 'success');
        });

        // Verificar se já instalado (Android)
        if (window.matchMedia('(display-mode: standalone)').matches) {
          this.isStandalone = true;
        }

        this.checkInstallCriteria();
      }

      showInstallBanner() {
        if (this.isStandalone || this.isBannerClosed()) return;

        const banner = document.getElementById('pwa-install-banner');
        if (banner && this.deferredPrompt) {
          banner.classList.remove('hidden');
        }
      }

      hideInstallBanner() {
        const banner = document.getElementById('pwa-install-banner');
        if (banner) banner.classList.add('hidden');
      }

      isBannerClosed() {
        const closedTime = localStorage.getItem(`${APP_CONFIG.STORAGE_PREFIX}bannerClosed`);
        if (!closedTime) return false;

        const closedDate = new Date(closedTime);
        const now = new Date();
        const diffHours = (now - closedDate) / (1000 * 60 * 60);

        // Mostrar novamente após 24 horas
        return diffHours < 24;
      }

      async installPWA() {
        if (!this.deferredPrompt) {
          this.showIOSInstructions();
          return;
        }

        try {
          this.deferredPrompt.prompt();
          const { outcome } = await this.deferredPrompt.userChoice;

          if (outcome === 'accepted') {
            console.log('Usuário aceitou a instalação');
            this.deferredPrompt = null;
            this.hideInstallBanner();
          } else {
            console.log('Usuário recusou a instalação');
          }
        } catch (error) {
          console.error('Erro na instalação:', error);
          toast('Erro ao instalar o app', 'error');
        }
      }

      showIOSInstructions() {
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

        if (isIOS && isSafari) {
          toast('📱 Toque no ícone de compartilhar e selecione "Adicionar à Tela de Início"', 'info', 8000);
        } else {
          toast('🔧 Use o menu do navegador para instalar o app', 'info');
        }
      }

      checkInstallCriteria() {
        const appLaunches = parseInt(localStorage.getItem(`${APP_CONFIG.STORAGE_PREFIX}appLaunches`) || '0');
        if (appLaunches > 2 && !this.isStandalone) {
          setTimeout(() => this.showInstallBanner(), 5000);
        }
      }
    }

    // ===== FUNÇÕES UTILITÁRIAS =====
    function toast(message, type = 'info', duration = 4000) {
      const container = document.getElementById('toast-container');
      if (!container) return;

      // CORREÇÃO: Limpa toasts anteriores para não duplicar
      container.innerHTML = '';

      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <i class="fas fa-${getToastIcon(type)}"></i>
        <span>${message}</span>
      `;

      container.appendChild(toast);
      setTimeout(() => toast.classList.add('show'), 10);

      setTimeout(() => {
        toast.classList.remove('show');
        toast.classList.add('hide');
        setTimeout(() => toast.remove(), 500);
      }, duration);
    }

    function getToastIcon(type) {
      const icons = {
        success: 'check-circle',
        error: 'exclamation-circle',
        warning: 'exclamation-triangle',
        info: 'info-circle'
      };
      return icons[type] || 'info-circle';
    }

    function toggleMenu(force = null) {
      const menu = document.getElementById('menu-dropdown');
      const isActive = menu.classList.contains('active');
      const shouldShow = force === true || (force === null && !isActive);

      if (shouldShow) {
        menu.classList.add('active');
      } else {
        menu.classList.remove('active');
      }
    }

    function nav(screen, modIdx = null, aulaIdx = null) {
      toggleMenu(false);

      // Esconder todas as telas
      document.querySelectorAll('.screen').forEach(s => {
        s.style.display = 'none';
        s.classList.remove('active');
      });

      // Mostrar tela alvo
      const target = document.getElementById(`screen-${screen}`);
      if (target) {
        target.style.display = 'block';
        target.classList.add('active');

        // Salvar estado
        if (appState) {
          appState.state.currentScreen = screen;
          if (modIdx !== null) appState.state.moduleIndex = modIdx;
          if (aulaIdx !== null) appState.state.aulaIndex = aulaIdx;
          appState.saveState();
        }
      }

      // Atualizar navegação
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });

      const navItem = document.getElementById(`nav-${screen}`);
      if (navItem) {
        navItem.classList.add('active');
      }

      // Renderizar conteúdo específico
      renderScreen(screen, modIdx, aulaIdx);
    }

    function renderScreen(screen, modIdx, aulaIdx) {
      switch (screen) {
        case 'home':
          renderHome();
          break;
        case 'profile':
          renderProfile();
          break;
        case 'about':
          // Já está renderizado em HTML
          break;
        case 'faq':
          setupFAQ();
          break;
        case 'benefits':
          setupBenefits();
          break;
        case 'sentiments':
          setupSentiments();
          break;
        case 'notes':
          renderNotes();
          break;
        case 'favorites':
          renderFavorites();
          break;
        case 'share':
          renderShare();
          break;
        case 'aulas':
          renderAulas(modIdx);
          break;
        case 'aula':
          renderAula(modIdx, aulaIdx);
          break;
        case 'complete':
          renderCompleteScreen(modIdx, aulaIdx);
          break;
      }
    }

    // ===== FUNÇÕES DE FAQ =====
    function toggleFAQ(element) {
      const answer = element.nextElementSibling;
      const icon = element.querySelector('i');

      if (answer.classList.contains('active')) {
        answer.classList.remove('active');
        icon.classList.remove('fa-chevron-up');
        icon.classList.add('fa-chevron-down');
      } else {
        // Fechar outras FAQs abertas
        document.querySelectorAll('.faq-answer.active').forEach(active => {
          active.classList.remove('active');
          active.previousElementSibling.querySelector('i').classList.remove('fa-chevron-up');
          active.previousElementSibling.querySelector('i').classList.add('fa-chevron-down');
        });

        answer.classList.add('active');
        icon.classList.remove('fa-chevron-down');
        icon.classList.add('fa-chevron-up');
      }
    }

    function setupFAQ() {
      // Adicionar event listeners para FAQs
      document.querySelectorAll('.faq-question').forEach(question => {
        question.addEventListener('click', function () {
          toggleFAQ(this);
        });
      });
    }

    function sendContactMessage() {
      const name = document.getElementById('contact-name').value.trim();
      const email = document.getElementById('contact-email').value.trim();
      const message = document.getElementById('contact-message').value.trim();

      if (!name || !email || !message) {
        toast('Por favor, preencha todos os campos', 'error');
        return;
      }

      if (!email.includes('@')) {
        toast('Por favor, insira um email válido', 'error');
        return;
      }

      // Simular envio da mensagem
      console.log('Mensagem de contato:', { name, email, message });

      // Limpar formulário
      document.getElementById('contact-name').value = '';
      document.getElementById('contact-email').value = '';
      document.getElementById('contact-message').value = '';

      toast('📧 Mensagem enviada com sucesso! Entraremos em contato em breve.', 'success');
    }

    // ===== FUNÇÕES DE ANOTAÇÕES =====
    function renderNotes() {
      if (!appState) return;

      const notesList = document.getElementById('notes-list');
      if (!notesList) return;

      if (!appState.state.notes || appState.state.notes.length === 0) {
        notesList.innerHTML = `
          <div style="text-align:center;padding:40px 20px;">
            <div style="font-size:4em;margin-bottom:20px;color:var(--muted);opacity:0.5;">
              <i class="fas fa-sticky-note"></i>
            </div>
            <h3 style="margin-bottom:10px;color:var(--muted);">Nenhuma anotação ainda</h3>
            <p class="muted">Comece a registrar seus aprendizados e reflexões!</p>
          </div>
        `;
        return;
      }

      notesList.innerHTML = appState.state.notes.map(note => `
        <div class="note-card" id="note-${note.id}">
          <div class="note-header">
            <div class="note-title">${note.title || 'Sem título'}</div>
            <div class="note-date">${formatDate(note.updatedAt || note.createdAt)}</div>
          </div>
          <div class="note-content">${note.content || ''}</div>
          ${note.tags ? `
            <div class="note-tags">
              ${note.tags.split(',').map(tag => tag.trim()).filter(tag => tag).map(tag => `
                <span class="note-tag">${tag}</span>
              `).join('')}
            </div>
          ` : ''}
          <div style="display:flex;gap:8px;margin-top:15px;">
            <button class="btn ghost" style="padding:8px 12px;font-size:0.85em;" onclick="editNote(${note.id})">
              <i class="fas fa-edit"></i> Editar
            </button>
            <button class="btn ghost" style="padding:8px 12px;font-size:0.85em;color:var(--danger);" onclick="deleteNote(${note.id})">
              <i class="fas fa-trash"></i> Excluir
            </button>
          </div>
        </div>
      `).join('');
    }

    function saveNote() {
      if (!appState) return;

      const title = document.getElementById('note-title').value.trim();
      const content = document.getElementById('note-content').value.trim();
      const tags = document.getElementById('note-tags').value.trim();

      if (!content) {
        toast('Por favor, escreva algo na anotação', 'error');
        return;
      }

      appState.addNote({
        title: title || `Anotação ${appState.state.notes.length + 1}`,
        content,
        tags
      });

      // Limpar formulário
      clearNoteForm();

      // Atualizar lista
      renderNotes();

      toast('📝 Anotação salva com sucesso!', 'success');
    }

    function clearNoteForm() {
      document.getElementById('note-title').value = '';
      document.getElementById('note-content').value = '';
      document.getElementById('note-tags').value = '';
    }

    function editNote(id) {
      if (!appState) return;

      const note = appState.state.notes.find(n => n.id === id);
      if (!note) return;

      document.getElementById('note-title').value = note.title || '';
      document.getElementById('note-content').value = note.content || '';
      document.getElementById('note-tags').value = note.tags || '';

      // Rolagem suave para o topo do editor
      document.querySelector('.note-editor').scrollIntoView({ behavior: 'smooth' });

      toast('📝 Pronto para editar a anotação', 'info');
    }

    function deleteNote(id) {
      if (!appState) return;

      if (confirm('Tem certeza que deseja excluir esta anotação?')) {
        if (appState.deleteNote(id)) {
          renderNotes();
          toast('🗑️ Anotação excluída', 'info');
        }
      }
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }

    // ===== FUNÇÕES DE FAVORITOS =====
    function renderFavorites() {
      if (!appState) return;

      const favoritesGrid = document.getElementById('favorites-grid');
      const emptyFavorites = document.getElementById('empty-favorites');

      if (!favoritesGrid || !emptyFavorites) return;

      const bookmarkedItems = appState.getBookmarkedItems();

      if (bookmarkedItems.length === 0) {
        favoritesGrid.innerHTML = '';
        emptyFavorites.style.display = 'block';
        return;
      }

      emptyFavorites.style.display = 'none';
      favoritesGrid.innerHTML = bookmarkedItems.map(item => `
        <div class="favorite-item" onclick="nav('aula', ${item.moduleId}, ${item.aulaId})">
          <div class="favorite-icon">
            <i class="fas fa-heart"></i>
          </div>
          <div class="favorite-info">
            <h4 style="margin:0 0 5px 0;">${item.aulaTitle}</h4>
            <p style="margin:0;font-size:0.9em;color:var(--muted);">${item.moduleTitle}</p>
            <div class="favorite-meta">
              <span><i class="fas fa-clock"></i> ${item.duration}</span>
              <span><i class="fas fa-book"></i> Aula ${item.aulaId + 1}</span>
            </div>
          </div>
          <div style="color:var(--primary);">
            <i class="fas fa-chevron-right"></i>
          </div>
        </div>
      `).join('');
    }

    // ===== FUNÇÕES DE COMPARTILHAMENTO =====
    function renderShare() {
      if (!appState) return;

      // Atualizar estatísticas
      const shareCount = document.getElementById('share-count');
      const referralCount = document.getElementById('referral-count');
      const impactScore = document.getElementById('impact-score');

      if (shareCount) shareCount.textContent = appState.state.shareStats.count || 0;
      if (referralCount) referralCount.textContent = appState.state.shareStats.referrals || 0;
      if (impactScore) impactScore.textContent = appState.state.shareStats.impactScore || 0;
    }

    function shareViaWhatsApp() {
      const text = encodeURIComponent("Conheça a Universidade de Pais - Curso incrível para fortalecer laços familiares! 🌟");
      const url = encodeURIComponent(window.location.href);
      window.open(`https://wa.me/?text=${text}%20${url}`, '_blank');
      appState.incrementShareStats('share');
      toast('📱 Compartilhado no WhatsApp!', 'success');
    }

    function shareViaFacebook() {
      const url = encodeURIComponent(window.location.href);
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
      appState.incrementShareStats('share');
      toast('📘 Compartilhado no Facebook!', 'success');
    }

    function shareViaInstagram() {
      toast('📷 Copie o link e compartilhe no Instagram!', 'info');
      copyShareLink();
    }

    function shareViaEmail() {
      const subject = encodeURIComponent("Universidade de Pais - Curso para Fortalecer Laços Familiares");
      const body = encodeURIComponent(`Olá! Recomendo este curso incrível para pais:\n\n${window.location.href}\n\nAbraços!`);
      window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
      appState.incrementShareStats('share');
      toast('📧 Link pronto para enviar por email!', 'success');
    }

    function copyShareLink() {
      const link = window.location.href;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(link).then(() => {
          toast('🔗 Link copiado para a área de transferência!', 'success');
          appState.incrementShareStats('share');
        }).catch(() => {
          fallbackCopyText(link);
        });
      } else {
        fallbackCopyText(link);
      }
    }

    function fallbackCopyText(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand('copy');
        toast('🔗 Link copiado!', 'success');
        appState.incrementShareStats('share');
      } catch (err) {
        toast('❌ Erro ao copiar link', 'error');
      }
      document.body.removeChild(textArea);
    }

    function copyInviteCode() {
      const code = "FAMILIA-UP2024";
      if (navigator.clipboard) {
        navigator.clipboard.writeText(code).then(() => {
          toast('🎁 Código de convite copiado!', 'success');
        }).catch(() => {
          fallbackCopyText(code);
        });
      } else {
        fallbackCopyText(code);
      }
    }

    function renderHome() {
      const modulesContainer = document.getElementById('modules');
      if (!modulesContainer) return;

      const modules = [
        {
          id: 0,
          title: "Módulo 1: Tranquilizando os Pais",
          description: "Acalmando preocupações comuns dos pais e fortalecendo a base familiar.",
          image: "https://i.pinimg.com/736x/0b/57/da/0b57dab511ce87d28abac1d7924e866d.jpg"
        },
        {
          id: 1,
          title: "Módulo 2: Conectando com o Adolescente",
          description: "Técnicas avançadas de escuta, empatia e validação de sentimentos.",
          image: "https://i.pinimg.com/736x/da/0c/83/da0c83747f596db117ee11efebaf20c6.jpg"
        },
        {
          id: 2,
          title: "Módulo 3: Ferramentas de Impacto",
          description: "Estratégias práticas para mudança de comportamento imediata.",
          image: "https://i.pinimg.com/736x/24/03/40/2403407a1d51c3524ea8e67c26ebac91.jpg"
        },
        {
          id: 3,
          title: "Módulo 4: Crescendo Juntos",
          description: "Visão de longo prazo e construção de legado familiar.",
          image: "https://i.pinimg.com/736x/54/2e/97/542e97ebc7efbe4718c41dea9d3c415a.jpg"
        }
      ];

      modulesContainer.innerHTML = modules.map(mod => `
        <div class="module" onclick="nav('aulas', ${mod.id})">
          <img class="module-img" src="${mod.image}" alt="${mod.title}">
          <div class="module-info">
            <h3>${mod.title}</h3>
            <p>${mod.description}</p>
            <div class="module-progress">
              <progress value="0" max="8"></progress>
              <span class="progress-text">0/8 aulas</span>
            </div>
          </div>
          <div class="module-status">▶️</div>
        </div>
      `).join('');
    }

    function renderAulas(moduleId) {
      const moduleData = COURSE_MODULES[moduleId];
      if (!moduleData) return;

      const titleEl = document.getElementById('aulas-title');
      const contentEl = document.getElementById('aulas-content');

      if (titleEl) titleEl.textContent = moduleData.title;
      if (contentEl) {
        contentEl.innerHTML = `
          <p class="muted" style="margin-bottom:20px;">${moduleData.description}</p>
          <div class="aulas-list">
            ${moduleData.aulas.map((aula, idx) => `
              <div class="module" onclick="nav('aula', ${moduleId}, ${idx})">
                <div class="module-info">
                  <h3>${aula.title}</h3>
                  <p>${aula.description}</p>
                  <div class="module-meta" style="display:flex;justify-content:space-between;margin-top:8px;">
                    <span class="muted"><i class="fas fa-clock"></i> ${aula.duration}</span>
                    ${appState.state.completedAulas[`M${moduleId}-A${idx}`] ?
            '<span style="color:var(--success);"><i class="fas fa-check-circle"></i> Concluída</span>' :
            '<span class="muted">Não iniciada</span>'}
                  </div>
                </div>
                <div class="module-status">▶️</div>
              </div>
            `).join('')}
          </div>
          <div style="margin-top:20px;">
            <button class="btn ghost" onclick="nav('home')">
              <i class="fas fa-arrow-left"></i> Voltar aos Módulos
            </button>
          </div>
        `;
      }
    }

    function renderAula(moduleId, aulaId) {
      const moduleData = COURSE_MODULES[moduleId];
      const aula = moduleData.aulas[aulaId];

      if (!aula) {
        console.error('Aula não encontrada:', moduleId, aulaId);
        return;
      }

      const contentEl = document.getElementById('aula-content');
      if (!contentEl) return;

      const isCompleted = appState.state.completedAulas[`M${moduleId}-A${aulaId}`];
      const quizData = QUIZZES.find(q => q.id === aula.quizId);
      const isQuizActive = appState.state.currentQuizStep > 0;
      const quizStep = isQuizActive ? appState.state.currentQuizStep - 1 : -1;
      const isBookmarked = appState.state.bookmarkedAulas.includes(`${moduleId}-${aulaId}`);

      let quizContent = '';
      if (isQuizActive && quizStep < quizData.steps.length) {
        const step = quizData.steps[quizStep];
        quizContent = `
          <div class="card quiz-step" style="margin-top:20px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
              <h3 style="margin:0;">${quizData.title}</h3>
              <span class="badge" style="background:var(--primary);color:white;padding:4px 8px;border-radius:12px;">
                ${quizStep + 1}/${quizData.steps.length}
              </span>
            </div>
            <p style="font-weight:600;font-size:1.1em;margin-bottom:20px;">${step.question}</p>
            <div class="options-grid">
              ${step.options.map((option, idx) => `
                <div class="option" onclick="submitAnswer(${moduleId}, ${aulaId}, ${idx})">
                  ${option}
                </div>
              `).join('')}
            </div>
            <div id="quiz-explanation" style="display:none;margin-top:20px;padding-top:20px;border-top:1px solid var(--bg);">
              <div style="background:rgba(58, 110, 165, 0.1);padding:15px;border-radius:var(--radius);">
                <p style="margin:0;font-weight:600;color:var(--primary);">💡 Explicação:</p>
                <p style="margin:8px 0 0 0;">${step.explanation}</p>
              </div>
              <button id="quiz-action-btn" class="btn" onclick="nextQuizStep(${moduleId}, ${aulaId})" 
                      style="margin-top:15px;width:100%;">
                ${quizStep + 1 < quizData.steps.length ? 'Próxima Pergunta →' : 'Ver Resultados →'}
              </button>
            </div>
          </div>
        `;
      } else if (isQuizActive && quizStep >= quizData.steps.length) {
        const score = appState.state.quizScores[`M${moduleId}-A${aulaId}`] || 0;
        const percentage = Math.round((score / quizData.steps.length) * 100);
        quizContent = `
          <div class="card" style="margin-top:20px;text-align:center;">
            <h3 style="margin-top:0;">🎉 Quiz Concluído!</h3>
            <div style="font-size:3em;font-weight:bold;color:${percentage >= 70 ? 'var(--success)' : 'var(--danger)'};">
              ${percentage}%
            </div>
            <p style="margin:10px 0;">Você acertou ${score} de ${quizData.steps.length} questões</p>
            <div style="display:flex;gap:10px;margin-top:20px;justify-content:center;">
              <button class="btn" onclick="markAulaComplete(${moduleId}, ${aulaId})">
                <i class="fas fa-check"></i> Concluir Aula
              </button>
              <button class="btn ghost" onclick="restartQuiz(${moduleId}, ${aulaId})">
                <i class="fas fa-redo"></i> Refazer Quiz
              </button>
            </div>
          </div>
        `;
      }

      contentEl.innerHTML = `
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
            <h2 style="margin:0;">${aula.title}</h2>
            ${isCompleted ?
          '<span style="background:var(--success);color:white;padding:4px 12px;border-radius:12px;font-size:0.8em;">✓ Concluída</span>' :
          ''}
          </div>
          <p class="muted" style="margin-bottom:20px;">${aula.description}</p>
          
          <div class="video-container">
            <iframe src="${aula.video}" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
            </iframe>
          </div>
          
          <div style="margin-top:20px;display:flex;gap:10px;flex-wrap:wrap;">
            <button class="btn" onclick="toggleBookmark(${moduleId}, ${aulaId})" style="${isBookmarked ? 'background:var(--danger);' : ''}">
              <i class="fas fa-heart"></i> ${isBookmarked ? 'Remover Favorito' : 'Favoritar'}
            </button>
            ${!isCompleted && !isQuizActive ? `
              <button class="btn" onclick="startQuiz(${moduleId}, ${aulaId})">
                <i class="fas fa-question-circle"></i> Iniciar Questionário
              </button>
            ` : ''}
            <button class="btn ghost" onclick="nav('aulas', ${moduleId})">
              <i class="fas fa-arrow-left"></i> Voltar
            </button>
          </div>
        </div>
        
        ${quizContent}
      `;
    }

    function startQuiz(moduleId, aulaId) {
      appState.state.currentQuizStep = 1;
      appState.saveState();
      renderAula(moduleId, aulaId);
    }

    function submitAnswer(moduleId, aulaId, selectedIndex) {
      const quizData = QUIZZES.find(q => q.id === COURSE_MODULES[moduleId].aulas[aulaId].quizId);
      const currentStep = appState.state.currentQuizStep - 1;
      const step = quizData.steps[currentStep];
      const aulaKey = `M${moduleId}-A${aulaId}`;

      // Desabilitar todas as opções
      document.querySelectorAll('.option').forEach(opt => {
        opt.style.pointerEvents = 'none';
        opt.style.cursor = 'default';
      });

      // Marcar resposta correta/incorreta
      document.querySelectorAll('.option').forEach((opt, idx) => {
        if (idx === step.answer) {
          opt.classList.add('correct');
        } else if (idx === selectedIndex) {
          opt.classList.add('wrong');
        }
      });

      // Contabilizar pontuação
      if (selectedIndex === step.answer) {
        appState.state.quizScores = appState.state.quizScores || {};
        appState.state.quizScores[aulaKey] = (appState.state.quizScores[aulaKey] || 0) + 1;
        toast('🎉 Resposta Correta!', 'success');
      } else {
        toast('📝 Resposta Incorreta. Aprenda com o erro!', 'warning');
      }

      appState.saveState();

      const explanation = document.getElementById('quiz-explanation');
      if (explanation) {
        explanation.style.display = 'block';
      }
    }

    function nextQuizStep(moduleId, aulaId) {
      const quizData = QUIZZES.find(q => q.id === COURSE_MODULES[moduleId].aulas[aulaId].quizId);

      if (appState.state.currentQuizStep >= quizData.steps.length) {
        // Última pergunta - ir para resultados
        appState.state.currentQuizStep = quizData.steps.length + 1;
      } else {
        appState.state.currentQuizStep++;
      }

      appState.saveState();
      renderAula(moduleId, aulaId);
    }

    function restartQuiz(moduleId, aulaId) {
      appState.state.currentQuizStep = 0;
      appState.saveState();
      renderAula(moduleId, aulaId);
    }

    function markAulaComplete(moduleId, aulaId) {
      const aulaKey = `M${moduleId}-A${aulaId}`;
      appState.state.completedAulas[aulaKey] = new Date().toISOString();
      appState.state.currentQuizStep = 0;
      appState.saveState();
      toast('🎉 Aula concluída com sucesso!', 'success');
      nav('complete');
    }

    function toggleBookmark(moduleId, aulaId) {
      const aulaKey = `${moduleId}-${aulaId}`;
      const index = appState.state.bookmarkedAulas.indexOf(aulaKey);

      if (index === -1) {
        appState.state.bookmarkedAulas.push(aulaKey);
        toast('❤️ Aula adicionada aos favoritos', 'success');
      } else {
        appState.state.bookmarkedAulas.splice(index, 1);
        toast('💔 Aula removida dos favoritos', 'info');
      }

      appState.saveState();

      // Atualizar visualização da aula
      renderAula(moduleId, aulaId);

      // Atualizar tela de favoritos se estiver visível
      if (document.getElementById('screen-favorites').style.display === 'block') {
        renderFavorites();
      }
    }

    function renderCompleteScreen(moduleId, aulaId) {
      const screen = document.getElementById('screen-complete');
      if (screen) {
        screen.innerHTML = `
          <div style="text-align:center;">
            <div style="font-size:4em;margin-bottom:20px;">🎉</div>
            <h2 style="margin-bottom:10px;">Parabéns!</h2>
            <p class="muted" style="margin-bottom:20px;">Aula concluída com sucesso!</p>
            <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
              <button class="btn" onclick="nav('aulas', ${moduleId})">
                <i class="fas fa-arrow-left"></i> Voltar às Aulas
              </button>
              <button class="btn" onclick="nav('home')">
                <i class="fas fa-home"></i> Página Inicial
              </button>
            </div>
          </div>
        `;
      }
    }

    function renderProfile() {
      if (!appState) return;

      const { account } = appState.state;
      const progress = appState.getProgress();

      // Preencher campos
      document.getElementById('profile-name').value = account.name || '';
      document.getElementById('profile-email').value = account.email || '';
      document.getElementById('dark-mode-toggle').checked = account.darkMode || false;
      document.getElementById('notifications-toggle').checked = account.notifications || true;
      document.getElementById('reminders-toggle').checked = account.reminders || false;

      // Atualizar estatísticas
      document.getElementById('stats-completed-profile').textContent = progress.completedCount;
      document.getElementById('stats-percentage-profile').textContent = progress.percentage + '%';
      document.getElementById('stats-favorites-profile').textContent =
        appState.state.bookmarkedAulas?.length || 0;

      // Aplicar modo escuro
      if (account.darkMode) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
    }

    function setupBenefits() {
      // Configurar filtros de benefícios
      const filterTabs = document.querySelectorAll('.filter-tab');
      filterTabs.forEach(tab => {
        tab.addEventListener('click', function () {
          filterTabs.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
        });
      });

      // Configurar cards de benefícios
      const benefitCards = document.querySelectorAll('.benefit-card');
      benefitCards.forEach(card => {
        card.addEventListener('click', function () {
          const title = this.querySelector('h3').textContent;
          toast(`Benefício: ${title}`, 'info');
        });
      });
    }

    function setupSentiments() {
      // Configurar filtros de emoções
      const filterButtons = document.querySelectorAll('.filter-btn');
      filterButtons.forEach(btn => {
        btn.addEventListener('click', function () {
          filterButtons.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });

      // Configurar cards de emoções
      const emotionCards = document.querySelectorAll('.sentiment-card');
      emotionCards.forEach(card => {
        card.addEventListener('click', function () {
          const emotion = this.querySelector('strong').textContent;
          const description = this.querySelector('.emotion-desc').textContent;
          toast(`${emotion}: ${description}`, 'info');
        });
      });
    }

    // ===== FUNÇÕES DO PERFIL =====
    function saveAccountSettings() {
      if (!appState) return;

      const name = document.getElementById('profile-name')?.value.trim();
      const email = document.getElementById('profile-email')?.value.trim();

      if (!name || !email) {
        toast('Preencha todos os campos', 'error');
        return;
      }

      if (!email.includes('@')) {
        toast('Email inválido', 'error');
        return;
      }

      appState.state.account.name = name;
      appState.state.account.email = email;
      appState.saveState();

      toast('✅ Configurações salvas com sucesso!', 'success');
    }

    function toggleDarkMode(checkbox) {
      if (!appState) return;

      appState.state.account.darkMode = checkbox.checked;
      appState.saveState();

      if (checkbox.checked) {
        document.body.classList.add('dark-mode');
        toast('🌙 Modo Escuro Ativado', 'info');
      } else {
        document.body.classList.remove('dark-mode');
        toast('☀️ Modo Claro Ativado', 'info');
      }
    }

    function handleNotificationToggle(checkbox) {
      if (!appState) return;

      appState.state.account.notifications = checkbox.checked;
      appState.saveState();

      toast(checkbox.checked ? '🔔 Notificações Ativadas' : '🔕 Notificações Desativadas', 'info');
    }

    function handleReminderToggle(checkbox) {
      if (!appState) return;

      appState.state.account.reminders = checkbox.checked;
      appState.saveState();

      toast(checkbox.checked ? '⏰ Lembretes Ativados' : '⏰ Lembretes Desativados', 'info');
    }

    function updateProfilePhoto(event) {
      const file = event.target.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        toast('Por favor, selecione uma imagem válida', 'error');
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        const photoElement = document.getElementById('profile-photo');
        photoElement.src = e.target.result;
        localStorage.setItem(`${APP_CONFIG.STORAGE_PREFIX}profilePhoto`, e.target.result);
        toast('📸 Foto atualizada com sucesso!', 'success');
      };
      reader.readAsDataURL(file);
    }

    function removeProfilePhoto() {
      const defaultPhoto = 'https://via.placeholder.com/120/3a6ea5/FFFFFF?text=FP';
      const photoElement = document.getElementById('profile-photo');
      photoElement.src = defaultPhoto;
      localStorage.removeItem(`${APP_CONFIG.STORAGE_PREFIX}profilePhoto`);
      toast('🗑️ Foto removida', 'info');
    }

    // ===== FUNÇÕES DE FILTRO =====
    function filterBenefits(category) {
      const cards = document.querySelectorAll('.benefit-card');

      cards.forEach(card => {
        if (category === 'all' || card.dataset.category === category) {
          card.style.display = 'flex';
        } else {
          card.style.display = 'none';
        }
      });
    }

    function filterEmotions(category) {
      const cards = document.querySelectorAll('.sentiment-card');

      cards.forEach(card => {
        if (category === 'all' || card.dataset.category === category) {
          card.style.display = 'flex';
        } else {
          card.style.display = 'none';
        }
      });
    }

    // ===== FUNÇÕES DE CONTA =====
    function handleExistingUser() {
      if (appState?.state?.account?.name && appState.state.account.email) {
        nav('home');
      } else {
        toast('Nenhuma conta encontrada. Por favor, cadastre-se.', 'warning');
      }
    }

    function saveInitialAccount() {
      const name = document.getElementById('signup-name')?.value.trim();
      const email = document.getElementById('signup-email')?.value.trim();

      if (!name || !email) {
        toast('Preencha todos os campos', 'error');
        return;
      }

      if (!email.includes('@')) {
        toast('Email inválido', 'error');
        return;
      }

      if (appState) {
        appState.state.account.name = name;
        appState.state.account.email = email;
        appState.state.currentScreen = 'home';
        appState.saveState();

        toast(`🎉 Bem-vindo(a), ${name}!`, 'success');
        nav('home');
      }
    }

    function exportUserData() {
      try {
        if (!appState) return;

        const data = {
          app: APP_CONFIG,
          exportDate: new Date().toISOString(),
          state: appState.state,
          profilePhoto: localStorage.getItem(`${APP_CONFIG.STORAGE_PREFIX}profilePhoto`)
        };

        const blob = new Blob([JSON.stringify(data, null, 2)],
          { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `universidade-pais-backup-${new Date().toISOString().slice(0, 10)}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        toast('💾 Dados exportados com sucesso!', 'success');
      } catch (error) {
        console.error('Erro ao exportar:', error);
        toast('Erro ao exportar dados', 'error');
      }
    }

    function clearAllData() {
      if (confirm('🚨 TEM CERTEZA? Isso apagará TODOS os seus dados permanentemente!')) {
        // Limpar localStorage
        Object.keys(localStorage).forEach(key => {
          if (key.startsWith(APP_CONFIG.STORAGE_PREFIX)) {
            localStorage.removeItem(key);
          }
        });

        toast('🗑️ Todos os dados foram apagados', 'warning');
        setTimeout(() => location.reload(), 2000);
      }
    }

    // ===== FUNÇÕES PWA =====
    function installPWA() {
      if (pwaManager) {
        pwaManager.installPWA();
      }
    }

    function closeInstallBanner() {
      const banner = document.getElementById('pwa-install-banner');
      if (banner) {
        banner.classList.add('hidden');
        localStorage.setItem(`${APP_CONFIG.STORAGE_PREFIX}bannerClosed`,
          new Date().toISOString());
      }
    }

    // ===== SERVICE WORKER =====
    function registerServiceWorker() {
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          const swCode = `
            const CACHE_NAME = 'universidade-pais-v4';
            
            self.addEventListener('install', event => {
              event.waitUntil(
                caches.open(CACHE_NAME)
                  .then(cache => {
                    return cache.addAll([
                      '/',
                      './index.html',
                      './manifest.json'
                    ]);
                  })
                  .then(() => self.skipWaiting())
              );
            });
            
            self.addEventListener('activate', event => {
              event.waitUntil(
                caches.keys().then(cacheNames => {
                  return Promise.all(
                    cacheNames.map(cache => {
                      if (cache !== CACHE_NAME) {
                        return caches.delete(cache);
                      }
                    })
                  );
                }).then(() => self.clients.claim())
              );
            });
            
            self.addEventListener('fetch', event => {
              event.respondWith(
                caches.match(event.request)
                  .then(response => {
                    return response || fetch(event.request);
                  })
              );
            });
          `;

          const swBlob = new Blob([swCode], { type: 'application/javascript' });
          const swURL = URL.createObjectURL(swBlob);

          navigator.serviceWorker.register(swURL)
            .then(registration => {
              console.log('✅ Service Worker registrado:', registration.scope);
            })
            .catch(error => {
              console.error('❌ Erro no Service Worker:', error);
            });
        });
      }
    }

    // ===== INICIALIZAÇÃO =====
    document.addEventListener('DOMContentLoaded', function () {
      // Inicializar gestores
      appState = new AppStateManager();
      pwaManager = new PWAInstallManager();

      // Registrar Service Worker
      registerServiceWorker();

      // Configurar event listeners
      document.addEventListener('click', (e) => {
        const menu = document.getElementById('menu-dropdown');
        const menuBtn = document.getElementById('menu-button');

        if (menu && menuBtn &&
          !menu.contains(e.target) &&
          !menuBtn.contains(e.target)) {
          toggleMenu(false);
        }
      });

      // Atalhos de teclado
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') toggleMenu(false);
      });

      // Carregar foto de perfil salva
      const savedPhoto = localStorage.getItem(`${APP_CONFIG.STORAGE_PREFIX}profilePhoto`);
      if (savedPhoto) {
        const photoElement = document.getElementById('profile-photo');
        if (photoElement) photoElement.src = savedPhoto;
      }

      // Carregar notas salvas
      if (appState.state.notes) {
        renderNotes();
      }

      // Navegar para tela inicial
      setTimeout(() => {
        nav(appState.state.currentScreen);
      }, 100);

      console.log(`🎓 ${APP_CONFIG.NAME} v${APP_CONFIG.VERSION} inicializado!`);
    });

    // ===== EXPORTAR FUNÇÕES =====
    window.nav = nav;
    window.toggleMenu = toggleMenu;
    window.toast = toast;
    window.toggleFAQ = toggleFAQ;
    window.sendContactMessage = sendContactMessage;
    window.saveNote = saveNote;
    window.clearNoteForm = clearNoteForm;
    window.editNote = editNote;
    window.deleteNote = deleteNote;
    window.saveInitialAccount = saveInitialAccount;
    window.saveAccountSettings = saveAccountSettings;
    window.handleExistingUser = handleExistingUser;
    window.toggleDarkMode = toggleDarkMode;
    window.handleNotificationToggle = handleNotificationToggle;
    window.handleReminderToggle = handleReminderToggle;
    window.updateProfilePhoto = updateProfilePhoto;
    window.removeProfilePhoto = removeProfilePhoto;
    window.exportUserData = exportUserData;
    window.clearAllData = clearAllData;
    window.installPWA = installPWA;
    window.closeInstallBanner = closeInstallBanner;
    window.filterBenefits = filterBenefits;
    window.filterEmotions = filterEmotions;
    window.startQuiz = startQuiz;
    window.submitAnswer = submitAnswer;
    window.nextQuizStep = nextQuizStep;
    window.restartQuiz = restartQuiz;
    window.markAulaComplete = markAulaComplete;
    window.renderAula = renderAula;
    window.renderAulas = renderAulas;
    window.toggleBookmark = toggleBookmark;
    window.shareViaWhatsApp = shareViaWhatsApp;
    window.shareViaFacebook = shareViaFacebook;
    window.shareViaInstagram = shareViaInstagram;
    window.shareViaEmail = shareViaEmail;
    window.copyShareLink = copyShareLink;
    window.copyInviteCode = copyInviteCode;
  </script>
</body>

</html>
